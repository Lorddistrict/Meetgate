{% extends 'default/base.html.twig' %}

{% block title %}Event{% endblock %}

{% block body %}

    <div class="meetgate">
        <div class="container-fluid event">
            <div class="intro">
                <div class="intro-content">
                    <img src="{{ event.picture }}" alt="{{ event.picture }}">
                    <div class="aside">
                        <h1>{{ event.title }}</h1>
                        <hr>
                        <div class="desc">
                            <p>
                                {{ event.description }}
                            </p>
                            <br>
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Date : </strong>{{ event.dateEvent|date('d / m / Y') }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Duree : </strong>
                                    {{ (event.duration > 1) ? event.duration ~ ' jours' : event.duration ~ ' jour' }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Prix : </strong>
                                    <span class="price">{{ (event.price > 0) ? event.price ~ '$' : 'Gratuit' }}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Tags : </strong>
                                    {% for tag in event.tag %}
                                        <a href="{{ url('tag', { id: tag.id }) }}" class="tag-link">
                                            <span class="badge badge-pill badge-success">{{ tag.name }}</span>&nbsp;
                                        </a>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Adress : </strong>
                                    {{ event.adress }}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <a href="{{ url('join', { id: event.id } ) }}" class="btn btn-success">Je participe</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clear"></div>
                    <br>
                    <hr>

                    <div class="container">
                        <div class="row">
                            <div class="col-md-6">
                                <div id='map' style='width: 100%; min-height: 500px;'></div>
                            </div>

                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12">
                                        Hello !<br>
                                        <strong>LATITUDE : </strong><span id="lat"></span><br>
                                        <strong>LONGITUDE : </strong><span id="lon"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>

        $(document).ready(function () {

            // $.get("https://nominatim.openstreetmap.org/search/" + "367 rue de Crespy" + "?format=json",
            $.get("https://nominatim.openstreetmap.org/search/" + "rue des allees" + "?format=json",
                function (data) {

                    console.log(data[0]);

                    $('#lat').append(data[0].lat);
                    $('#lon').append(data[0].lon);

                    var map = L.map('map');
                    map.setView([ data[0].lat, data[0].lon ], 15);

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);

                    L.marker([ data[0].lat, data[0].lon ]).addTo(map).bindPopup('{{ event.adress }}').openPopup();
                }
            );


        });

    </script>

    <script type="application/javascript">
        $(document).ready(function(){
           $('span.badge').hover(function(){
               $(this).toggleClass('badge-success');
               $(this).toggleClass('badge-warning');
           });
        });
    </script>

{% endblock %}